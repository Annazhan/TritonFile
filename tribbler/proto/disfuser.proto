// DO NOT MODIFY
syntax = "proto2";

// DO NOT MODIFY
package disfuser;

message FRequest {
    required uint32 uid = 1;
    required uint32 gid = 2;
    required uint32 pid = 3;
}

message Read {
    required FRequest frequest = 1;
    required uint64 ino = 2;
    required uint64 fh = 3;
    required int64 offset= 4;
    required uint32 size = 5;
    required int32 flags = 6;
    optional uint64 lock_owner = 7;
}

message Data {
    required uint32 data = 1; // [u8]
}

message Write {
    required FRequest frequest = 1;
    required uint64 ino = 2;
    required uint64 fh = 3;
    required int64 offset= 4;
    required string data = 5; // [u8]
    required uint32 write_flag = 6;
    required int32 flags = 7;
    optional uint64 lock_owner = 8;
}

message LookUp {
    required FRequest frequest = 1;
    required uint64 parent = 2;
    // OsStr name = 3;
    required string name = 3;
}

message Create {
    required FRequest frequest = 1;
    required uint64 parent = 2;
    // OsStr name = 3;
    required string name = 3;
    required uint32 mode= 4;
    required uint32 umask = 5;
    required int32 flags = 6;
}

message Unlink {
    required FRequest frequest = 1;
    required uint64 parent = 2;
    // OsStr name = 3;
    required string name = 3;
}

message Reply {
    required string message = 1; // [u8] or fileAttr string
    required int32 errcode = 2; // for the Err when unwrap
}

message writeReply {
    required uint32 size = 1;
    required int32 errcode = 2;
}

message createReply {
    required string fileAttr = 1;
    required uint64 fh = 2;
    required int32 errcode = 3;
}

message unlinkReply {
    required int32 errcode = 1;
}

service disfuser {
    rpc read(Read) returns (stream Reply) {}
    rpc write(stream Write) returns (writeReply) {}
    rpc lookup(LookUp) returns (Reply) {} 
    rpc create(Create) returns (createReply) {} 
    rpc unlink(Unlink) returns (unlinkReply) {} 
}
